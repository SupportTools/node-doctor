---
apiVersion: v1
kind: ConfigMap
metadata:
  name: node-doctor-controller-config
  namespace: node-doctor
  labels:
    app.kubernetes.io/name: node-doctor-controller
    app.kubernetes.io/component: controller
    app.kubernetes.io/part-of: node-doctor
data:
  controller.yaml: |
    # Node Doctor Controller Configuration

    server:
      bindAddress: "0.0.0.0"
      port: 8080
      readTimeout: 30s
      writeTimeout: 30s
      enableCORS: false

    storage:
      path: /data/node-doctor.db
      retention: 720h  # 30 days

    correlation:
      enabled: true
      clusterWideThreshold: 0.3  # 30% of nodes affected = cluster issue
      evaluationInterval: 30s
      minNodesForCorrelation: 2

    coordination:
      enabled: true
      maxConcurrentRemediations: 3
      defaultLeaseDuration: 5m
      cooldownPeriod: 10m

    prometheus:
      enabled: true
      port: 9090
      path: /metrics

    kubernetes:
      enabled: true
      inCluster: true
      namespace: node-doctor
      createEvents: true
